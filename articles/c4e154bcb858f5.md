---
title: "Vue2ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«CompositionAPIã‚’å°å…¥ã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã¿ã‚‹"
emoji: "ğŸ”§"
type: "tech"
topics: ["typescript", "vue"]
published: true
---

Vue3ã§å°å…¥ã•ã‚ŒãŸCompositionAPIã‚’ä½¿ã†ã¨Reactã§è¨€ã†ã¨ã“ã‚ã®Hooksã®ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã—ã‚„ã™ããªã‚‹ã®ã§ã™ãŒã€å‘¨è¾ºãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã¾ã å¯¾å¿œã§ãã¦ã„ãªã„ã‚‚ã®ã‚‚å¤šã‹ã£ãŸã‚Šã—ã¦ã€ã¾ã æ°—è»½ã«ç§»è¡Œã—ã«ãã„ã¨æ„Ÿã˜ã¦ã„ã‚‹æ–¹ã‚‚å¤šã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ãã“ã§ä»Šå›ã¯Vue2ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«CompositionAPIã‚’å°å…¥ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨æ„ã™ã‚‹
ä»Šå›ã¯Vue CLIã‚’ä½¿ç”¨ã—ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`5.0.0-beta.2`ã¨ã—ã¦ã„ã¾ã™ã€‚
Nodeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`15.8.0`ã¨ã—ã¾ã—ãŸã€‚

```
â¯ node -v
v15.8.0

â¯ vue create my-project

// ä»¥ä¸‹è¨­å®šå€¤ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§è¨­å®šã—ã¾ã—ãŸãŒã€Vue2ã§ã‚ã‚Œã°ãŠãã‚‰ãä»Šå›ã¯å•é¡Œãªã„ã‹ã¨æ€ã„ã¾ã™ï¼‰
? Please pick a preset: Manually select features
? Check the features needed for your project: Choose Vue version, Babel, TS, Linter, Unit, E2E
? Choose a version of Vue.js that you want to start the project with 2.x
? Use class-style component syntax? Yes
? Use Babel alongside TypeScript (required for modern mode, auto-detected polyfills, transpiling JSX)? Yes
? Pick a linter / formatter config: Prettier
? Pick additional lint features: Lint on save
? Pick a unit testing solution: Jest
? Pick an E2E testing solution: Cypress
? Where do you prefer placing config for Babel, ESLint, etc.? In dedicated config files
? Save this as a preset for future projects? No
```

# ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
ãã‚Œã£ã½ã„æ§‹æˆã‚’ç”¨æ„ã—ã¾ã™ã€‚

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```ts:App.vue
<template>
  <div>
    <table v-if="!loading">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Company</th>
          <th>isAdmin</th>
        </tr>
      </thead>
      <tbody>
        <UserRow v-for="user in users" :user="user" :key="user.id" />
      </tbody>
    </table>
    <div v-if="loading">ãƒ­ãƒ¼ãƒ‰ä¸­</div>
  </div>
</template>

<script lang="ts">
import { Component, Vue } from "vue-property-decorator";
import { User } from "./@types";
import UserRow from "./components/UserRow.vue";
import { sleep } from "./utils";

@Component({
  components: {
    UserRow,
  },
})
export default class App extends Vue {
  users: User[] = [];
  loading = true;

  async mounted(): Promise<void> {
    // 3ç§’æ›ã‘ã¦APIã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸
    this.users = await new Promise<User[]>((resolve) => {
      sleep(3).then(() => {
        resolve([
          { id: 1, name: "Bob", company: "Company A", isAdmin: true },
          { id: 2, name: "Kate", company: "Company B", isAdmin: false },
        ]);
      });
    });
    this.loading = false;
  }
}
</script>
```

```ts:UserRow.vue
<template>
  <tr>
    <td>{{ user.id }}</td>
    <td>{{ user.name }}</td>
    <td>{{ user.company }}</td>
    <td>{{ user.isAdmin }}</td>
  </tr>
</template>

<script lang="ts">
import { Component, Prop, Vue } from "vue-property-decorator";
import { User } from "../@types";

@Component
export default class UserRow extends Vue {
  @Prop() private user!: User;
}
</script>
```

ã“ã‚“ãªæ„Ÿã˜ã®ç”»é¢ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/9e733c7e514839eb8bd72387.png)

## å‹
```ts:@types/index.d.ts
export type User = {
  id: number;
  name: string;
  company: string;
  isAdmin: boolean;
};
```

## ãã®ä»–ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã®sleepå‡¦ç†ï¼‰
```ts:utils/index.ts
export function sleep(sec: number): Promise<void> {
  return new Promise((resolve) => setTimeout(resolve, sec * 1000));
}
```

# CompositionAPIã‚’å°å…¥ã™ã‚‹

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
yarn add @vue/composition-api
```

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦èª­ã¿è¾¼ã‚€
`main.ts`ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```diff ts:main.ts
import Vue from "vue";
+ import VueCompositionApi from "@vue/composition-api";
import App from "./App.vue";

+ Vue.use(VueCompositionApi);

Vue.config.productionTip = false;

new Vue({
  render: (h) => h(App),
}).$mount("#app");
```

ã€€ã“ã‚Œã§æº–å‚™ã‚ªãƒƒã‚±ãƒ¼ã§ã™ã€‚
 
 # ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã¿ã‚‹
 
 `App.vue`å†…ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤–ã«åˆ‡ã‚Šå‡ºã—ã¦ã¿ã¾ã™ã€‚
 æ–°ã—ããƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
 
 ```ts:composable/useUserData.ts
 import { User } from "@/@types";
import { sleep } from "@/utils";
import { Ref, ref } from "@vue/composition-api";

export function useUserData(): { loading: Ref<boolean>; users: Ref<User[]> } {
  const loading = ref<boolean>(true);
  const users = ref<User[]>([]);

  const fetchData = async () => {
    const res = await new Promise<User[]>((resolve) => {
      sleep(3).then(() => {
        resolve([
          { id: 1, name: "Bob", company: "Company A", isAdmin: true },
          { id: 2, name: "Kate", company: "Company B", isAdmin: false },
        ]);
      });
    });
    users.value = res;
    loading.value = false;
  };
  fetchData();

  return { loading, users };
}
 ```
 
 æ¬¡ã«ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†`App.vue`ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚
 `class-style`ã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€`defineComponent`ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ã€‚
 
 ```ts:App.vue
 <template>
  <div>
    <table v-if="!loading">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Company</th>
          <th>isAdmin</th>
        </tr>
      </thead>
      <tbody>
        <UserRow v-for="user in users" :user="user" :key="user.id" />
      </tbody>
    </table>
    <div v-if="loading">ãƒ­ãƒ¼ãƒ‰ä¸­</div>
  </div>
</template>

<script lang="ts">
import { defineComponent } from "@vue/composition-api";
import { useUserData } from "@/composable/useUserData";
import UserRow from "./components/UserRow.vue";

export default defineComponent({
  components: {
    UserRow,
  },
  setup() {
    const { loading, users } = useUserData();
    return {
      users,
      loading,
    };
  },
});
</script>
 ```
 
 # ä½•ãŒå¬‰ã—ã„ã®ã‹
 ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆãªã®ã§ã€ä¼ã‚ã‚Šã«ãã„éƒ¨åˆ†ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€
 ã‚ã‚‹ç¨‹åº¦ã®è¦æ¨¡ã«ãªã£ã¦ãã‚‹ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¸Šæ‰‹ãåˆ†ã‘ãŸã¨ã—ã¦ã‚‚
 çµå±€å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æƒ…å ±ã‚’æ›¸ãæ›ãˆãŸã‚Šã™ã‚‹ã“ã¨ãŒã‚ã£ãŸã‚Šã—ã¦
 è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç‰¹ã«`Atomic Design`ã«ãŠã‘ã‚‹`Templates`ã‚„`Pages`ãªã©ï¼‰ãŒã‚‚ã¤æƒ…å ±é‡ãŒå¤šããªã‚ŠãŒã¡ã§ã™ã€‚
 
 ãã†ã„ã£ãŸã¨ãã«é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¾ã¨ã‚ã¦æ‰±ãˆã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚
 ä»Šå›ã®å ´åˆã¯`loading`ã¨`users`ã‚’`useUserData`ã¨ã„ã†é–¢æ•°ã®ä¸­ã§ã¾ã¨ã‚ã¦ã‚ã¤ã‹ã„ã€`App.vue`ã‹ã‚‰ãªã‚‹ã¹ãåˆ‡ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚
 
 ä¸Šæ‰‹ãç”»é¢ã‹ã‚‰æƒ…å ±ã‚’åˆ‡ã‚Šå‡ºã—ã¦è¦‹é€šã—ã®è‰¯ã„å®Ÿè£…ã«ãªã‚‹ã‚ˆã†ã«å¿ƒãŒã‘ãŸã„ã§ã™ã­ã€‚
 
 # å‚è€ƒ
 https://v3.vuejs.org/api/composition-api.html#composition-api
 https://github.com/vuejs/composition-api
 